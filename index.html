<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3ì¸ í”Œë­í¬ ì±Œë¦°ì§€</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        }
    </style>
</head>

<body class="bg-gradient-to-br from-orange-50 to-red-50 min-h-screen p-6">
    <div class="max-w-5xl mx-auto">

        <!-- Header -->
        <div class="text-center mb-8">
            <div class="flex items-center justify-center gap-3 mb-4">
                <span class="text-4xl">ğŸ”¥</span>
                <h1 class="text-4xl font-bold text-gray-800">3ì¸ í”Œë­í¬ ì±Œë¦°ì§€</h1>
                <span class="text-4xl">ğŸ”¥</span>
            </div>
            <p class="text-gray-600">DB ì—°ë™ ë²„ì „</p>
        </div>

        <!-- Day Selector -->
        <div class="bg-white rounded-xl p-6 shadow-md mb-6">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-2xl font-bold text-gray-800">ì˜¤ëŠ˜ì˜ ì±Œë¦°ì§€</h2>
                <div class="flex gap-2">
                    <button onclick="changeDay(-1)" class="px-4 py-2 bg-gray-200 rounded-lg hover:bg-gray-300">â—€</button>
                    <div id="currentDayDisplay" class="px-6 py-2 bg-orange-500 text-white rounded-lg font-bold">Day 1</div>
                    <button onclick="changeDay(1)" class="px-4 py-2 bg-gray-200 rounded-lg hover:bg-gray-300">â–¶</button>
                </div>
            </div>
            <div class="text-center">
                <div id="targetDisplay" class="text-4xl font-bold mb-2 text-orange-600"></div>
                <div id="setsDisplay" class="text-lg text-gray-600"></div>
            </div>
        </div>

        <!-- Leaderboard -->
        <div class="bg-gradient-to-r from-yellow-400 to-orange-500 text-white rounded-xl p-6 shadow-lg mb-6">
            <div class="flex items-center justify-center gap-3 mb-4">
                <span class="text-2xl">ğŸ†</span>
                <h3 class="text-2xl font-bold">ë¦¬ë”ë³´ë“œ</h3>
            </div>
            <div id="leaderboard" class="space-y-3"></div>
        </div>

        <!-- Players -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6" id="playersContainer"></div>

        <!-- Tips -->
        <div class="bg-white rounded-xl p-6 shadow-md">
            <h3 class="text-xl font-bold text-gray-800 mb-4">ğŸ’¡ ì„±ê³µ íŒ</h3>
            <ul class="space-y-2 text-gray-700">
                <li>âœ“ <strong>ì˜¬ë°”ë¥¸ ìì„¸:</strong> ì–´ê¹¨-ì—‰ë©ì´-ë°œëª©ì´ ì¼ì§ì„ </li>
                <li>âœ“ <strong>í˜¸í¡:</strong> ìì—°ìŠ¤ëŸ½ê²Œ ì´ì–´ê°€ê¸°</li>
                <li>âœ“ <strong>ì„¸íŠ¸ ê°„ íœ´ì‹:</strong> 30ì´ˆ~1ë¶„</li>
                <li>âœ“ <strong>ë¬´ë¦¬ ê¸ˆì§€:</strong> í†µì¦ì´ ëŠê»´ì§€ë©´ ì¦‰ì‹œ ì¤‘ë‹¨</li>
            </ul>
        </div>
    </div>

<script>
/* ===========================
1. ë°±ì—”ë“œ API ì„¤ì •
   =========================== */
const API_BASE = "http://162.120.184.232:3000/api";

/* ===========================
2. ìŠ¤ì¼€ì¤„ ì •ë³´
   =========================== */
const schedule = [
    { day: 1, duration: 20, sets: 2, rest: false },
    { day: 2, duration: 20, sets: 2, rest: false },
    { day: 3, duration: 30, sets: 2, rest: false },
    { day: 4, duration: 30, sets: 2, rest: false },
    { day: 5, duration: 40, sets: 2, rest: false },
    { day: 6, duration: 0, sets: 0, rest: true },
    { day: 7, duration: 45, sets: 2, rest: false },
    { day: 8, duration: 45, sets: 2, rest: false },
    { day: 9, duration: 60, sets: 2, rest: false },
    { day: 10, duration: 60, sets: 2, rest: false },
    { day: 11, duration: 70, sets: 2, rest: false },
    { day: 12, duration: 90, sets: 2, rest: false },
    { day: 13, duration: 0, sets: 0, rest: true },
    { day: 14, duration: 90, sets: 2, rest: false },
    { day: 15, duration: 90, sets: 3, rest: false },
    { day: 16, duration: 120, sets: 2, rest: false },
    { day: 17, duration: 120, sets: 2, rest: false },
    { day: 18, duration: 150, sets: 2, rest: false },
    { day: 19, duration: 150, sets: 2, rest: false },
    { day: 20, duration: 0, sets: 0, rest: true },
    { day: 21, duration: 180, sets: 2, rest: false },
    { day: 22, duration: 180, sets: 2, rest: false },
    { day: 23, duration: 210, sets: 2, rest: false },
    { day: 24, duration: 210, sets: 2, rest: false },
    { day: 25, duration: 240, sets: 2, rest: false },
    { day: 26, duration: 240, sets: 2, rest: false },
    { day: 27, duration: 0, sets: 0, rest: true },
    { day: 28, duration: 270, sets: 2, rest: false },
    { day: 29, duration: 270, sets: 2, rest: false },
    { day: 30, duration: 300, sets: 1, rest: false },
];

let currentDay = 1;
let players = [];

/* ===========================
3. API í•¨ìˆ˜
   =========================== */
async function apiGet(path) {
    const res = await fetch(`${API_BASE}${path}`);
    return res.json();
}
async function apiPost(path, data) {
    await fetch(`${API_BASE}${path}`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data)
    });
}

/* ===========================
4. ë‚ ì§œ ë³€ê²½
   =========================== */
async function changeDay(delta) {
    currentDay = Math.max(1, Math.min(30, currentDay + delta));
    await apiPost("/state", { currentDay });
    render();
}

/* ===========================
5. ì‹œê°„ í‘œì‹œ í•¨ìˆ˜
   =========================== */
function formatTime(seconds) {
    if (seconds === 0) return "íœ´ì‹ì¼";
    if (seconds < 60) return `${seconds}ì´ˆ`;
    const m = Math.floor(seconds / 60);
    const s = seconds % 60;
    return s ? `${m}ë¶„ ${s}ì´ˆ` : `${m}ë¶„`;
}

/* ===========================
6. ì™„ë£Œ ì²´í¬
   =========================== */
async function toggleCompletion(playerId) {
    const player = players.find(p => p.id === playerId);
    const prev = player.progress[currentDay] === true;
    const next = !prev;

    await apiPost("/progress", {
        playerId,
        day: currentDay,
        completed: next
    });

    await loadPlayers();
    render();
}

/* ===========================
7. í”Œë ˆì´ì–´ ì´ë¦„ ë³€ê²½
   =========================== */
async function updatePlayerName(id, name) {
    await apiPost("/players", { id, name });
    await loadPlayers();
    render();
}

/* ===========================
8. ìƒíƒœ ë¡œë“œ
   =========================== */
async function loadState() {
    const state = await apiGet("/state");
    currentDay = state.currentDay;
}

/* ===========================
9. í”Œë ˆì´ì–´ ë¡œë“œ
   =========================== */
async function loadPlayers() {
    players = await apiGet("/players");
}

/* ===========================
10. ë¦¬ë”ë³´ë“œ
   =========================== */
function getLeaderboard() {
    const list = players.map(p => ({
        id: p.id,
        name: p.name || `ì°¸ê°€ì ${p.id}`,
        score: Object.values(p.progress).filter(v => v).length
    }));
    return list.sort((a, b) => b.score - a.score);
}

/* ===========================
11. ë Œë”ë§
   =========================== */
function render() {
    const info = schedule[currentDay - 1];

    document.getElementById("currentDayDisplay").textContent = `Day ${currentDay}`;
    document.getElementById("targetDisplay").textContent = formatTime(info.duration);
    document.getElementById("setsDisplay").textContent = info.rest ? "" : `${info.sets} ì„¸íŠ¸`;

    /* âœ… ë¦¬ë”ë³´ë“œ */
    const lb = getLeaderboard();
    const medals = ["ğŸ¥‡", "ğŸ¥ˆ", "ğŸ¥‰"];
    document.getElementById("leaderboard").innerHTML = lb.map((p, i) => `
        <div class="bg-white bg-opacity-20 rounded-lg p-4 flex items-center justify-between">
            <div class="flex items-center gap-3">
                <div class="text-2xl">${medals[i] || ""}</div>
                <div class="text-xl font-bold">${p.name}</div>
            </div>
            <div class="text-2xl font-bold">${p.score}ì¼</div>
        </div>
    `).join("");

    /* âœ… í”Œë ˆì´ì–´ ì¹´ë“œ */
    document.getElementById("playersContainer").innerHTML = players.map(p => {
        const completed = p.progress[currentDay] === true;
        return `
            <div class="bg-white rounded-xl p-6 shadow-md">
                <input value="${p.name}" onchange="updatePlayerName(${p.id}, this.value)"
                    class="w-full px-4 py-2 rounded-lg border-2 mb-4" placeholder="ì°¸ê°€ì ${p.id} ì´ë¦„">

                <button onclick="toggleCompletion(${p.id})"
                    class="w-full py-4 rounded-xl font-bold text-lg ${
                        completed ? "bg-green-500 text-white" : "bg-gray-200"
                    }">
                    ${completed ? "âœ“ ì™„ë£Œ!" : "ì˜¤ëŠ˜ ìš´ë™ ì²´í¬í•˜ê¸°"}
                </button>
            </div>
        `;
    }).join("");
}

/* ===========================
12. ì´ˆê¸°í™”
   =========================== */
async function init() {
    await loadState();
    await loadPlayers();
    render();
}

init();
</script>
</body>
</html>
